# Base TicketItem styling and scaling
<-TicketItem>:
    text_size: [None, None]
    size_hint: (0.25, None)
    font_name: 'Roboto'
    markup: True
    font_size: self.height * 0.45
    halign: 'center'
    padding: (0, 0)
    # Default opacity = 0 so that animate_in will make it fade in
    opacity: 0
    background_normal: ''
    #background_active: ''
    background_color: 0, 0, 0, 0.6
    state_image: self.background_normal if self.state == 'normal' else self.background_down
    disabled_image: self.background_disabled_normal if self.state == 'normal' else self.background_disabled_down
    _scale: 1. if self.texture_size[0] < self.width else float(self.width) / self.texture_size[0]
    # Crazy shit for making text scale to the available space
    canvas:
        Color:
            rgba: self.background_color
        BorderImage:
            border: self.border
            pos: self.pos
            size: self.size
            source: self.disabled_image if self.disabled else self.state_image
        PushMatrix
        Scale:
            origin: self.center
            x: self._scale or 1.
            y: self._scale or 1.
        Color:
            rgba: self.disabled_color if self.disabled else self.color
        Rectangle:
            texture: self.texture
            size: self.texture_size
            pos: int(self.center_x - self.texture_size[0] / 2.), int(self.center_y - self.texture_size[1] / 2.)
        PopMatrix

# NewTicketItem(TicketItem) styling
<NewTicketItem>:
    background_color: 1, 0, 0, 0.85
    #font_size: 90
    size_hint: (.5, None)
    #size: self.texture_size

# PinnedTicketItem(TicketItem) styling
<PinnedTicketItem>:
    size_hint: (.2, None)
    height: 60

# Wrap in WindowManager so new screens can be added later if desired
WindowManager:

    # Main Screen
    DashboardScreen:
        id: 'dashboard'
        canvas.before:
            Rectangle:
                pos: self.pos
                #size: root.bg_texture.texture.size
                size: self.size
                source: 'assets/images/bg.jpg'
        # Big box around everything
        BoxLayout:
            orientation: 'vertical'
            padding: 20
            size_hint: 1, 1

            # Big box around content area
            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1, 1

                # Left side layout
                BoxLayout:
                    id: left_layout
                    orientation: 'vertical'
                    size_hint: (0.66, 1)

                    # Open Tickets header
                    BoxLayout:
                        orientation: 'vertical'
                        #size_hint: 1, .5
                        Button:
                            id: ticket_header
                            text: 'Open Tickets'
                            background_normal: ''
                            background_color: 0, 0, 0, 0
                            size_hint: (1, .2)
                            #height: 70
                            font_size: 70
                            markup: True
                            on_press: app.get_tickets_from_sheet()

                        # Open Tickets items
                        StackLayout:
                            #size_hint: 1, None
                            id: tickets
                            spacing: 10


                        Button:
                            id: pins_header
                            text: 'Pinned Items'
                            background_normal: ''
                            background_color: 0, 0, 0, 0

                            #height: 50
                            font_size: 50
                            size_hint: 1, .15
                            markup: True
                            #on_press: app.get_tickets_from_sheet()

                        # Pinned Tickets items
                        StackLayout:
                            id: pins
                            spacing: 10

                        # Spacer to avoid the bottom
                        Label:
                            size_hint: (1, .2)


                # Right side layout
                BoxLayout:
                    id: right_layout
                    size_hint: (0.33, 1)
                    AnchorLayout:
                        anchor_x: 'right'
                        anchor_y: 'top'

                        Button:
                            id: options_button
                            text: 'o'
                            on_touch_down: app.open_settings()
                            size_hint: None, None
                            size: self.texture_size

        # Spacer to avoid the bottom
        Label:
            size_hint: (1, .2)



        # Time / Date section - anchored
        AnchorLayout:
            anchor_y: 'bottom'
            anchor_x: 'left'
            size_hint: (1, 0.2)
            padding: 20

            # Time / Date horizontal split
            BoxLayout:
                orientation: 'horizontal'

                # Time on left
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint: (0.5, None)

                    # Time 00:00
                    Label:
                        id: time
                        text: '[b]00[/b]:00'
                        font_name: 'Roboto'
                        markup: True
                        font_size: 128
                        size_hint: (None, 1)
                        pos_hint: {'right': 1}
                        size: (self.texture_size[0], self.line_height)

                    # Seconds / AM/PM Vertical split
                    BoxLayout:
                        orientation: 'vertical'
                        size_hint: (None, None)

                        # Seconds
                        Label:
                            id: seconds
                            text: '00'
                            font_name: 'Roboto'
                            markup: True
                            font_size: 60
                            halign: 'left'
                            pos_hint: {'left': 1}
                            size_hint: None, 1
                            #size: (self.texture_size[0], self.line_height / 2)
                            size: (self.texture_size[0], root.ids.time.height / 2)

                        # AM/PM indicator
                        Label:
                            id: ampm
                            text: 'XM'
                            font_name: 'Roboto'
                            markup: True
                            font_size: 60
                            halign: 'left'
                            pos_hint: {'left': 1}
                            size_hint: None, 1
                            size: (self.texture_size[0], root.ids.time.height / 2)

                # Date
                Label:
                    id: calendar
                    text: 'Monday, Octember 32'
                    font_name: 'Roboto'
                    markup: True
                    font_size: 90
                    size: self.texture_size
                    size_hint: (None, None)

